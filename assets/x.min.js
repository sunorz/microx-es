function updateTimeElements(){const e=document.querySelectorAll("span.time"),t=new Date,n=document.querySelector(".notice"),o=t.getDate(),s=document.querySelectorAll(".tweet");n&&(o>20&&s.length<5?n.style.display="block":n.style.display="none"),e.forEach(e=>{const n=e.textContent.trim(),o=new Date(n.replace(/-/g,"/"));if(isNaN(o.getTime()))return;const s=t-o,i=Math.floor(s/1e3),l=Math.floor(i/60),r=Math.floor(l/60),a=Math.floor(r/24);let c;if(i<60)c="Now";else if(l<60)c=`${l}m`;else if(r<24)c=`${r}h`;else if(a<7)c=`${a}d`;else{const e=o.getFullYear(),t=o.getMonth()+1,n=o.getDate();c=`${e}/${t}/${n}`}e.textContent=c})}function rotateImage(e){const t=e.querySelector("img");t.src="../images/load2.svg"}function stopAnimation(){if(animationId&&(clearTimeout(animationId),animationId=null),minLoadTimer&&(clearTimeout(minLoadTimer),minLoadTimer=null),currentAudio&&currentAudio._onReady&&(currentAudio.removeEventListener("canplay",currentAudio._onReady),delete currentAudio._onReady),currentPlayer){const e=currentPlayer.querySelector(".bars"),t=currentPlayer.querySelector(".play-icon");e.style.display="none",t.style.display="block",t.innerHTML='<svg viewBox="0 0 100 100" width="60" height="60" xmlns="http://www.w3.org/2000/svg">\n                <path class="playsvg" d=" M 20 15 Q 20 10 25 13 L 85 48 Q 90 50 85 52 L 25 87 Q 20 90 20 85 Z"/></svg>';const n=e.querySelectorAll(".bar");n.forEach(e=>e.style.height="30px"),currentAudio&&(currentAudio.pause(),currentAudio.currentTime=0),currentPlayer=null,currentAudio=null}}function startRandomAnimation(e,t,n){function o(){t.forEach(e=>{const t=Math.floor(20*Math.random())+5;e.style.height=`${t}px`}),animationId=setTimeout(o,200)}e.style.display="flex",n.style.display="none",o()}function isMobile(){return window.innerWidth<=600}function positionTooltip(){if(isMobile())tooltip.classList.add("show");else{const e=badge.getBoundingClientRect(),t=window.scrollY||document.documentElement.scrollTop,n=window.scrollX||document.documentElement.scrollLeft,o=8,s=-100;tooltip.style.top=`${e.bottom+t+o}px`,tooltip.style.left=`${e.left+n+s}px`}}function showTooltip(){positionTooltip(),tooltip.style.display="block"}function hideTooltip(){tooltip.style.display="none",tooltip.classList.remove("show")}function hasVisibleDynamicMask(){const e=document.querySelectorAll(".custom-confirm-mask");for(const t of e){const e="none"!==window.getComputedStyle(t).display,n="hidden"!==window.getComputedStyle(t).visibility;if(e&&n&&t.offsetWidth>0&&t.offsetHeight>0)return!0}const t=document.getElementById("preview-modal");if(t){const e="none"!==window.getComputedStyle(t).display,n="hidden"!==window.getComputedStyle(t).visibility;if(e&&n&&t.offsetWidth>0&&t.offsetHeight>0)return!0}return!1}function controlTabsByTweetCount(){const e=document.querySelectorAll(".tweet"),t=document.querySelectorAll(".twi-tabs");if(e.length<4?t.length>1&&(t[1].style.display="none"):t.length>1&&(t[1].style.display=""),0===e.length){const e=document.querySelector(".notice");if(e){if("block"===window.getComputedStyle(e).display)return!1;const t=e.querySelectorAll("div");t.length>=2&&(t[1].innerHTML="No tweets have been posted."),e.style.display="block"}}}const date=new Date;document.write(date.getFullYear()),document.addEventListener("DOMContentLoaded",updateTimeElements),setInterval(updateTimeElements,6e4),document.addEventListener("DOMContentLoaded",function(){function e(e){const t=e.parentElement,n=e.getBoundingClientRect(),o=t.getBoundingClientRect(),i=n.left-o.left,l=n.width;s.style.transform=`translateX(${i}px)`,s.style.width=`${l}px`}function t(e){return e<1e3?e:e<1e6?`${(e/1e3).toFixed(1)}K`:e<1e9?`${(e/1e6).toFixed(1)}M`:`${(e/1e9).toFixed(2)}B`}function n(){const e=new Date(Date.UTC(2025,4,1,16,0,0)),t=new Date,n=Math.floor((t.getTime()-e.getTime())/864e5),o=10,s=.5,i=465,l=9455,r=(83621-o*i-s*l)/31;let a=0;for(let e=0;e<=n;e++){const t=r+e*o+e*e*s;a+=t}return Math.floor(a)}const o=document.querySelectorAll(".twi-tabs"),s=document.querySelector(".tab-underline"),i=document.querySelector(".all"),l=document.querySelector(".twi-comment"),r=document.querySelector(".bottom-banner"),a=document.querySelectorAll(".all .tweet");o.forEach((t,n)=>{t.addEventListener("click",function(){o.forEach(e=>e.classList.remove("active")),this.classList.add("active"),e(this),0===n&&i?(r&&(r.innerText="latest"),i.style.display="block",l&&(l.style.display="none"),a.forEach((e,t)=>{e.style.display=t<3?"block":"none"})):1===n&&i&&(r&&(r.innerText="all"),i.style.display="block",l&&(l.style.display="none"),a.forEach(e=>{e.style.display="block"}))}),o.length>0&&i&&o[0].click()});const c=t(n());document.getElementById("followers").textContent=c;let d=!0;const m=["jpg","jpeg","png","gif","webp","avif"],u=["mp4","mov","webm","m3u8"];document.querySelectorAll(".loading").forEach(e=>{"IMG"!==e.tagName&&"VIDEO"!==e.tagName||e.removeAttribute("src"),e.addEventListener("click",async function(){async function e(e){try{const t=new AbortController,n=setTimeout(()=>t.abort(),1e4),o=await fetch(e,{method:"HEAD",credentials:"include",signal:t.signal});return clearTimeout(n),o.status}catch(e){return"AbortError"===e.name?-1:0}}function t(e,t){if(!t)return;const n=e.match(/^([^-]+)-/);if(!n)return;const o=n[1],i=`../images/private/${o}.md`;fetch(i,{method:"HEAD"}).then(e=>{if(e.ok)return fetch(i,{credentials:"include"}).then(e=>e.text()).then(e=>{const t=document.createElement("div");t.className="media-c",t.innerHTML=e,s.appendChild(t)})})}if(this.classList.contains("loading-in-progress"))return;const n=this.getAttribute("data-media"),o=this.getAttribute("data-copyright");if(!n||0===n.length)return void setTimeout(()=>{this.classList.remove("loading-in-progress"),this.classList.remove("loading"),this.innerHTML='<div class="load-insert load-msg"><img class="load-icon" src="../images/error.svg"></div>';let e=this.querySelector(".load-insert");e.style.setProperty("--load-text",'"Error 500"')},5e3);if(!this.classList.contains("loading"))return;o&&"off"===o&&(d=!1),this.classList.add("loading-in-progress");const s=this,i=n.split(",").map(e=>e.trim()).filter(e=>e);if(1===i.length){const a=i[0],c=a.split(".").pop().toLowerCase(),g=`../images/private/${a}`,y=`/wsfile.html?file=${a}`;if(u.includes(c)){const p=await e(y);if(200!=p){s.innerHTML='\n        <div class="load-insert load-msg">\n            <img class="load-icon" src="../images/error.svg">\n        </div>\n    ',s.classList.remove("loading-in-progress","loading"),s.classList.add("error-state");const f=s.querySelector(".load-insert");return void(f&&f.style.setProperty("--load-text",`"Error ${p}"`))}const h=document.createElement("video");h.className="tweet-video video-js vjs-default-skin",h.controls=!0,h.preload="metadata",h.style.pointerEvents="auto",h.style.display="none";const v=a.toLowerCase().endsWith(".m3u8");if(v){s.appendChild(h);const w=videojs(h,{techOrder:["html5"],sources:[{src:y,type:"application/x-mpegURL"}],controlBar:{pictureInPictureToggle:!1},errorDisplay:!1});w.ready(()=>{t(a,d);const e=()=>{const e=w.el().querySelector("video");let t=e.videoWidth||300,n=e.videoHeight||300;(t<=0||n<=0)&&(t=300,n=300);const o=300,i=300,l=t/n;let r,a;l>1?(r=o,a=o/l):(a=i,r=i*l);const c=w.el();c.style.width=`${r}px`,c.style.height=`${a}px`,c.style.minWidth="100px",e.style.width="100%",e.style.height="100%",s.classList.remove("loading-in-progress"),s.classList.remove("loading");const d=s.querySelector(".load-insert"),m=s.querySelectorAll("video, div");m.forEach(e=>{"none"===e.style.display&&(e.style.display="",d.remove())})},n=w.el().querySelector("video");n.addEventListener("loadedmetadata",e),setTimeout(e,3e3),n.addEventListener("loadeddata",e)}),w.on("error",()=>{window.capturedHttpStatus?l({status:window.capturedHttpStatus}):l({status:null})})}else h.src=y,s.innerHTML="",s.appendChild(h),h.onloadeddata=()=>{s.classList.remove("loading-in-progress"),s.classList.remove("loading"),t(a,d)};function l(e){const t=s.querySelector(".video-js");t&&t.parentNode.removeChild(t),window.player&&window.player.dispose&&(window.player.dispose(),window.player=null);const n={401:"401",403:"403",404:"404",415:"415",500:"500"};let o,i=e.status;i||(4===e.code?i=415:2===e.code&&(i=404)),o=i?n[i]||`Error ${i}`:"网络连接异常：无法加载视频",s.innerHTML='\n        <div class="load-insert load-msg">\n            <img class="load-icon" src="../images/error.svg">\n        </div>\n    ',s.classList.remove("loading-in-progress","loading"),s.classList.add("error-state");const l=s.querySelector(".load-insert");l&&l.style.setProperty("--load-text",`"${o.replace(/"/g,'\\"')}"`)}}else fetch(g,{credentials:"include",headers:{"Cache-Control":"no-cache"}}).then(e=>{if(!e.ok){s.classList.remove("loading-in-progress"),s.classList.remove("loading"),s.innerHTML='<div class="load-insert"><img class="load-icon" src="../images/error.svg"></div>';let t=s.querySelector(".load-insert");throw t.style.setProperty("--load-text",`"Error ${e.status}"`),new Error(`${e.status}`)}if(!m.includes(c)){s.innerHTML='<div class="load-insert load-msg"><img class="load-icon" src="../images/error.svg"></div>',s.classList.remove("loading-in-progress"),s.classList.remove("loading");let e=s.querySelector(".load-insert");throw e.style.setProperty("--load-text",'"Error 500"'),new Error("500")}{const e=new Image;e.src=g,e.className="tweet-image",e.onload=()=>{s.innerHTML="",s.appendChild(e),t(a,d),s.classList.remove("loading-in-progress"),s.classList.remove("loading")},e.onerror=()=>{s.innerHTML='<div class="load-insert load-msg"><img class="load-icon" src="../images/error.svg"></div>',s.classList.remove("loading-in-progress"),s.classList.remove("loading");let e=s.querySelector(".load-insert");e.style.setProperty("--load-text",'"Error 404"')}}}).catch(e=>{s.classList.remove("loading-in-progress"),s.classList.remove("loading"),s.innerHTML='<div class="load-insert load-msg"><img class="load-icon" src="../images/error.svg"></div>';let t=s.querySelector(".load-insert");t.style.setProperty("--load-text",`"Error ${e.message}"`)})}else if(i.length>1){const L=i.every(e=>{const t=e.split(".").pop().toLowerCase();return m.includes(t)});if(!L){s.classList.remove("loading-in-progress"),s.classList.remove("loading"),s.innerHTML='<div class="load-insert load-msg"><img class="load-icon" src="../images/error.svg"></div>';let S=s.querySelector(".load-insert");return void S.style.setProperty("--load-text",'"Error 500"')}const b=document.createElement("div");b.className="multi-image-container";let E=i.length,T=0;function r(){if(T===E){s.classList.remove("loading-in-progress"),s.classList.remove("loading"),s.innerHTML="";const e=b.children.length;if(e>0)s.appendChild(b),i.length>0&&t(i[0],d);else{s.innerHTML='<div class="load-insert load-msg"><img class="load-icon" src="../images/error.svg"></div>';let e=s.querySelector(".load-insert");e.style.setProperty("--load-text",'"Error 401"')}}}i.forEach(e=>{const t=`../images/private/${e}`,n=new Image;n.src=t,n.className="tweet-image",n.onload=()=>{b.appendChild(n),T++,r()},n.onerror=()=>{T++,r()}})}})});const g=document.querySelectorAll(".trans-button");g.forEach(e=>{e.addEventListener("click",()=>{const t=e.nextElementSibling;document.querySelectorAll(".tweet-text.trans").forEach(e=>{e.style.display="none"}),document.querySelectorAll(".trans-button").forEach(e=>{e.style.display="block"}),t.style.display="block",e.style.display="none"})});const y=n();document.querySelectorAll(".tweet-content").forEach(e=>{const n=document.createElement("div");n.className="tweet-actions";const o=.005+.845*Math.random(),s=.975+Math.random()*(1.247-.975),i=Math.round(y*o),l=Math.round(y*s),r=Math.random(),a=r<.5?2*r:2*(1-r),c=Math.round(512*(1-a));n.innerHTML=`\n            <div class="action-item">\n            <svg viewBox="0 0 24 24" aria-hidden="true" class="acomment"><g><path d="M12 2.59l5.7 5.7-1.41 1.42L13 6.41V16h-2V6.41l-3.3 3.3-1.41-1.42L12 2.59zM21 15l-.02 3.51c0 1.38-1.12 2.49-2.5 2.49H5.5C4.11 21 3 19.88 3 18.5V15h2v3.5c0 .28.22.5.5.5h12.98c.28 0 .5-.22.5-.5L19 15h2z"></path></g></svg>\n                <span class="action-count">${t(c)}</span>\n            </div>\n            <div class="action-item">\n                <svg viewBox="0 0 24 24" aria-hidden="true" class="alike">\n                    <g><path d="M16.697 5.5c-1.222-.06-2.679.51-3.89 2.16l-.805 1.09-.806-1.09C9.984 6.01 8.526 5.44 7.304 5.5c-1.243.07-2.349.78-2.91 1.91-.552 1.12-.633 2.78.479 4.82 1.074 1.97 3.257 4.27 7.129 6.61 3.87-2.34 6.052-4.64 7.126-6.61 1.111-2.04 1.03-3.7.477-4.82-.561-1.13-1.666-1.84-2.908-1.91zm4.187 7.69c-1.351 2.48-4.001 5.12-8.379 7.67l-.503.3-.504-.3c-4.379-2.55-7.029-5.19-8.382-7.67-1.36-2.5-1.41-4.86-.514-6.67.887-1.79 2.647-2.91 4.601-3.01 1.651-.09 3.368.56 4.798 2.01 1.429-1.45 3.146-2.1 4.796-2.01 1.954.1 3.714 1.22 4.601 3.01.896 1.81.846 4.17-.514 6.67z"></path></g>\n                </svg>\n                <span class="action-count">${t(i)}</span>\n            </div>\n            <div class="action-item">\n                <svg viewBox="0 0 24 24" aria-hidden="true" class="avisit">\n                    <g><path d="M8.75 21V3h2v18h-2zM18 21V8.5h2V21h-2zM4 21l.004-10h2L6 21H4zm9.248 0v-7h2v7h-2z"></path></g>\n                </svg>\n                <span class="action-count">${t(l)}</span>\n            </div>\n        `,e.appendChild(n)}),document.querySelectorAll(".alike").forEach(e=>{e.addEventListener("click",e=>{const t=document.createElement("div");t.className="floating-plus1",t.innerHTML='\n  <svg viewBox="0 0 24 24" aria-hidden="true" class="alike pinkh">\n                    <g><path d="M16.697 5.5c-1.222-.06-2.679.51-3.89 2.16l-.805 1.09-.806-1.09C9.984 6.01 8.526 5.44 7.304 5.5c-1.243.07-2.349.78-2.91 1.91-.552 1.12-.633 2.78.479 4.82 1.074 1.97 3.257 4.27 7.129 6.61 3.87-2.34 6.052-4.64 7.126-6.61 1.111-2.04 1.03-3.7.477-4.82-.561-1.13-1.666-1.84-2.908-1.91zm4.187 7.69c-1.351 2.48-4.001 5.12-8.379 7.67l-.503.3-.504-.3c-4.379-2.55-7.029-5.19-8.382-7.67-1.36-2.5-1.41-4.86-.514-6.67.887-1.79 2.647-2.91 4.601-3.01 1.651-.09 3.368.56 4.798 2.01 1.429-1.45 3.146-2.1 4.796-2.01 1.954.1 3.714 1.22 4.601 3.01.896 1.81.846 4.17-.514 6.67z"></path></g>\n                </svg>\n';const n=Math.floor(41*Math.random())-20;t.style.setProperty("--float-x",`${n}px`),t.style.left=`${e.pageX}px`,t.style.top=`${e.pageY}px`,document.body.appendChild(t),setTimeout(()=>{t.remove()},1e3)})})});const lazyImages=document.querySelectorAll(".lazyload"),observer=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target,o=n.dataset.src;fetch(o).then(e=>e.blob()).then(e=>{const t=URL.createObjectURL(e);n.src=t,n.onload=()=>{URL.revokeObjectURL(t),n.classList.remove("lazyload")}}).catch(e=>{console.error("Error loading image:",e)}),t.unobserve(n)}})});lazyImages.forEach(e=>{observer.observe(e)});let currentPlayer=null,currentAudio=null,animationId=null,minLoadTimer=null;document.querySelectorAll(".player").forEach(e=>{const t=e.querySelector(".bars"),n=t.querySelectorAll(".bar"),o=e.querySelector("audio"),s=e.querySelector(".play-icon"),i=o.getAttribute("data-media");e.addEventListener("click",()=>{const l=currentPlayer===e;if(l)stopAnimation();else{stopAnimation(),currentPlayer=e,currentAudio=o,s.innerHTML='<img class="load-audio-icon" src="../images/load2.svg">';let a=!1,c=!1;const d=()=>{a=!0,r()};function r(){if(a&&c){const e=o.play();void 0!==e?e.then(()=>{startRandomAnimation(t,n,s)}).catch(e=>{console.warn("音频播放被阻止或出错",e)}):startRandomAnimation(t,n,s)}}o._onReady=d,o.addEventListener("canplay",d,{once:!0}),minLoadTimer=setTimeout(()=>{c=!0,r()},5e3),o.src=i,o.load()}}),o.addEventListener("ended",()=>{stopAnimation()})});const badge=document.querySelector(".original"),tooltip=document.getElementById("badge-tooltip");if(badge.addEventListener("click",e=>{e.stopPropagation(),"block"===tooltip.style.display?hideTooltip():showTooltip()}),document.addEventListener("click",e=>{tooltip.contains(e.target)||e.target===badge||hideTooltip()}),window.addEventListener("resize",()=>{"block"===tooltip.style.display&&positionTooltip()}),document.addEventListener("click",async function(e){const t=e.target.closest(".acomment");if(!t)return;const n=t.closest(".tweet");if(!n)return;const o=n.dataset.tweetId||"",s=n.querySelector(".tweet-text")?.innerHTML||"",i=n.querySelector(".tweet-text.trans")?.innerHTML||"",l=document.getElementById("post-actions");l&&(l.style="none");const r=document.getElementById("capture-area");r.innerHTML=`\n        <div style="\n            max-width: 500px;\n            width:100%;\n            min-height: 100px;\n            padding: 14px;\n            background-color:var(--md-background);\n            color: var(--md-on-background);\n            font-family: 'Noto Serif SC', 'Georgia', 'Times New Roman', serif;\n        ">\n            <div id="original-text" style="font-size: 12px;padding:8px;line-height:2;text-indent:2em;">${s}</div>\n            <div style="font-size: 12px;padding:8px;line-height:2;direction: rtl;text-align: right;" class="ar">${i}</div>\n           <div style="\n    font-size: 5%; /* 父容器宽度的百分比 */\n    padding:0.5rem;\n    text-align:center;\n    position:absolute;\n    top:50%;\n    left:50%;\n    transform: translate(-50%, -50%) rotate(-30deg);\n    border:5px solid #f28b82; /* 相对缩放 */\n    color:#f28b82;\n    z-index:-1;\n    white-space: nowrap;\n">\n    Alta gama de fachada
\n</div>\n        </div>\n    `;const a=r.querySelector("#original-text");if(a){const e=a.innerText.trim(),t=window.getComputedStyle(a),n=parseFloat(t.fontSize),o=a.clientWidth,s=Math.floor(o/n);e.length<=s&&(a.style.textIndent="0")}const c=await html2canvas(r.querySelector("div")),d=c.toDataURL("image/png"),m=document.getElementById("preview-modal"),u=document.getElementById("preview-image-container"),g=document.getElementById("download-btn"),y=document.querySelector(".qq-titlebar-button.close"),p=document.getElementById("shareimage");u.innerHTML=`<img src="${d}" style="width: 100%;display:block;" />`,u.style.backgroundPosition="center",new MutationObserver((e,t)=>{let n=document.getElementById("post-actions");n&&(n.style.display="none",t.disconnect())}).observe(document.body,{childList:!0,subtree:!0}),m.style.display="flex",document.body.style.overflow="hidden",document.getElementById("preview-modal").style.display="flex",p.style.display="block",g.onclick=()=>{const e=document.createElement("a");e.download=`tweet${o}.png`,e.href=d,e.click(),document.body.style.overflow="",document.getElementById("preview-modal").style.display="none"},y.onclick=()=>{document.body.style.overflow="",document.getElementById("preview-modal").style.display="none"}}),window.innerWidth,window.innerWidth>767){const e=10;let t=[];const n=new Date;let o=new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate()));const s=new Date(o);s.setUTCDate(o.getUTCDate()-30);const i=e=>`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}`,l=async(e,t)=>{const n=await fetch(`https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY&start_date=${i(e)}&end_date=${i(t)}`),o=await n.json();return o.filter(e=>"image"===e.media_type&&new Date(e.date)<=t)},r=async()=>{let n=o,i=new Date(n);for(i.setUTCDate(n.getUTCDate()-9);t.length<e&&i>=s;){try{const e=await l(i,n);t=[...e,...t]}catch(e){console.error("APOD fetch error:",e);break}n=new Date(i),i.setUTCDate(n.getUTCDate()-9),i<s&&(i=new Date(s))}if(t.length){const e=t[Math.floor(Math.random()*t.length)];document.documentElement.style.setProperty("--bg-url",`url(${e.url})`)}};r()}document.addEventListener("DOMContentLoaded",controlTabsByTweetCount);